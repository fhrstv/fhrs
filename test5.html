<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>صفحتي الخاصة</title>
    <style>
        body {
            margin: 0;
            font-family: Arial, sans-serif;
            background-color: #f4f4f4;
        }
        header {
            background-color: #333;
            color: #fff;
            padding: 10px;
            text-align: center;
            font-size: 24px;
        }
        .content {
            padding: 20px;
            text-align: center;
        }
        iframe {
            width: 100%;
            height: 600px;
            border: none;
            margin-top: 20px;
        }
        .subtitle-box, .torrent-box, .direct-download-box {
            margin-top: 20px;
            padding: 15px;
            background-color: #333;
            color: #fff;
            display: inline-block;
            border-radius: 5px;
            cursor: pointer;
        }
        .subtitle-box:hover, .torrent-box:hover, .direct-download-box:hover {
            background-color: #555;
        }
        #movies, #quality-container {
            margin-top: 20px;
        }
        #movies li, #quality-container button {
            background-color: #555;
            color: #fff;
            margin: 5px 0;
            padding: 10px;
            list-style: none;
            cursor: pointer;
        }
        #movies li:hover, #quality-container button:hover {
            background-color: #777;
        }
    </style>
</head>
<body>
    <header>
        مرحباً بكم في صفحتي الخاصة
    </header>

    <div class="content">
        <p>هنا يمكن أن تضع محتوى خاص بك مثل نصوص، صور، أو أي شيء تريده.</p>

        <iframe id="movieFrame" allowfullscreen></iframe>
        
        <div class="subtitle-box" id="subtitleBox">
            حمل الترجمة
        </div>

        <div class="torrent-box" id="torrentBox">
            تحميل التورنت
        </div>

        

        <ul id="movies"></ul>
        <div id="quality-container"></div>
    </div>

    <script>
const urlParams = new URLSearchParams(window.location.search);
const tmdbId = urlParams.get('tmdb_id');

if (!tmdbId) {
    alert('TMDB ID غير موجود في الـ URL');
    return;
}

const tmdbApiKey = 'cf64a661774f647b7513facb9f1e55e5'; // مفتاح API الخاص بك

(async function fetchData() {
    try {
        // استخدم async/await لتحميل البيانات بشكل متزامن
        const tmdbResponse = await fetch(`https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${tmdbApiKey}`);
        const tmdbData = await tmdbResponse.json();

        const imdbId = tmdbData.imdb_id;

        if (!imdbId) {
            alert('لم يتم العثور على IMDb ID');
            return;
        }

        // تحديث iframe مع رابط dl.vidsrc.vip باستخدام الـ IMDb ID
        document.getElementById('movieFrame').src = `https://dl.vidsrc.vip/movie/${imdbId}`;

        // عرض التورنت تلقائياً باستخدام الـ IMDb ID
        displayTorrents(imdbId);

        // إعداد زر تحميل الترجمة
        document.getElementById('subtitleBox').onclick = function () {
            const subtitleUrl = `https://www.opensubtitles.org/ar/search2/sublanguageid-all/moviename-${imdbId}`;
            window.location.href = subtitleUrl;
        };
    } catch (error) {
        console.error('Error fetching data:', error);
        document.getElementById('movies').innerHTML = '<li>حدث خطأ أثناء التحميل</li>';
        document.getElementById('quality-container').innerHTML = '<p>حدث خطأ أثناء التحميل</p>';
    }
})();

async function displayTorrents(imdbId) {
    try {
        const ytsResponse = await fetch(`https://yts.mx/api/v2/list_movies.json?query_term=${encodeURIComponent(imdbId)}`);
        const ytsData = await ytsResponse.json();

        const movies = ytsData.data.movies;
        const movieList = document.getElementById('movies');
        const qualityContainer = document.getElementById('quality-container');
        
        movieList.innerHTML = '';
        qualityContainer.innerHTML = '';

        if (movies && movies.length > 0) {
            movies.forEach(movie => {
                const li = document.createElement('li');
                li.innerHTML = `<span class="movie-title">${movie.title}</span> (${movie.year})`;
                movieList.appendChild(li);

                // عرض جودات التورنت تلقائيًا
                fetchMovieTorrents(movie.id);
            });
        } else {
            movieList.innerHTML = '<li>لم يتم العثور على أفلام</li>';
            qualityContainer.innerHTML = '<p>لا توجد جودات متاحة</p>';
        }
    } catch (error) {
        console.error('Error fetching torrents:', error);
    }
}

async function fetchMovieTorrents(movieId) {
    try {
        const response = await fetch(`https://yts.mx/api/v2/movie_details.json?movie_id=${movieId}`);
        const data = await response.json();
        const movie = data.data.movie;
        const qualityContainer = document.getElementById('quality-container');

        if (movie && movie.torrents.length > 0) {
            movie.torrents.forEach(torrent => {
                const p = document.createElement('p');
                p.textContent = `${torrent.quality} (${torrent.size}) - تحميل`;
                p.style.cursor = 'pointer';
                p.onclick = function() {
                    window.location.href = torrent.url;
                };
                qualityContainer.appendChild(p);
            });
        } else {
            qualityContainer.innerHTML = '<p>لا توجد جودات متاحة</p>';
        }
    } catch (error) {
        console.error('Error fetching movie details:', error);
    }
}
    </script>
</body>
</html>