<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <style>
        .movie-box {
            margin: 10px;
            padding: 5px;
            border: 1px solid #ddd;
            display: inline-block;
            width: 200px;
        }
    </style>
</head>
<body>
    <input type="text" id="search-box" placeholder="Search for movies...">
    <div id="movie-list"></div>

    <script>
        async function searchMovies(query) {
            try {
                const response = await fetch(`/search?query=${encodeURIComponent(query)}`);
                if (!response.ok) {
                    throw new Error('Network response was not ok');
                }
                const movies = await response.json();
                updateMovieList(movies);
            } catch (error) {
                console.error('Error fetching search results:', error);
            }
        }

        function updateMovieList(movies) {
            const movieList = document.getElementById('movie-list');
            movieList.innerHTML = '';

            if (movies.length === 0) {
                movieList.innerHTML = '<p>No movies found</p>';
            } else {
                movies.forEach(movie => {
                    const movieBox = document.createElement('div');
                    movieBox.className = 'movie-box';

                    const movieLink = document.createElement('a');
                    movieLink.href = `movie.html?tmdb_id=${movie.tmdb_id}`;
                    movieLink.target = '_blank';

                    const movieTitle = document.createElement('span');
                    movieTitle.textContent = movie.title || 'Unnamed Movie';
                    movieLink.appendChild(movieTitle);

                    movieBox.appendChild(movieLink);
                    movieList.appendChild(movieBox);
                });
            }
        }

        document.getElementById('search-box').addEventListener('input', (event) => {
            const query = event.target.value;
            if (query.length > 2) { // بدء البحث بعد إدخال 3 أحرف
                searchMovies(query);
            } else {
                updateMovieList([]); // مسح النتائج إذا كان النص قصيرًا جدًا
            }
        });
    </script>
</body>
</html>