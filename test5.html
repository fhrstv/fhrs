<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Search</title>
    <style>
        .movie-box {
            margin: 10px;
            padding: 5px;
            border: 1px solid #ddd;
            display: inline-block;
            width: 200px;
        }
    </style>
</head>
<body>
    <input type="text" id="search-box" placeholder="Search for movies...">
    <div id="movie-list"></div>

    <script>
        const TOTAL_PAGES = 1543; // عدد الصفحات
        const allMovies = []; // لتخزين الأفلام

        // تحميل الأفلام من صفحة معينة
        async function fetchMoviesFromPage(pageNumber) {
            const url = `https://vidsrc.xyz/movies/latest/page-${pageNumber}.json`;
            try {
                const response = await fetch(url);
                if (!response.ok) {
                    throw new Error('Failed to load page ' + pageNumber);
                }
                const data = await response.json();
                return data.result || [];
            } catch (error) {
                console.error('Error fetching page', pageNumber, error);
                return [];
            }
        }

        // تحميل جميع الأفلام من الصفحات
        async function loadAllMovies() {
            for (let pageNumber = 1; pageNumber <= TOTAL_PAGES; pageNumber++) {
                const movies = await fetchMoviesFromPage(pageNumber);
                if (movies.length > 0) {
                    allMovies.push(...movies);
                    console.log(`Loaded page ${pageNumber}, total movies: ${allMovies.length}`);
                } else {
                    break; // إذا لم تكن هناك أفلام في الصفحة، توقف عن التحميل
                }
            }
            console.log('All movies loaded');
        }

        // البحث في الأفلام
        function searchMovies(query) {
            query = query.toLowerCase();
            const results = allMovies.filter(movie => movie.title.toLowerCase().includes(query));
            updateMovieList(results);
        }

        // تحديث قائمة الأفلام في الصفحة
        function updateMovieList(movies) {
            const movieList = document.getElementById('movie-list');
            movieList.innerHTML = '';

            if (movies.length === 0) {
                movieList.innerHTML = '<p>No movies found</p>';
            } else {
                movies.forEach(movie => {
                    const movieBox = document.createElement('div');
                    movieBox.className = 'movie-box';

                    const movieLink = document.createElement('a');
                    movieLink.href = `movie.html?tmdb_id=${movie.tmdb_id}`;
                    movieLink.target = '_blank';

                    const movieTitle = document.createElement('span');
                    movieTitle.textContent = movie.title || 'Unnamed Movie';
                    movieLink.appendChild(movieTitle);

                    movieBox.appendChild(movieLink);
                    movieList.appendChild(movieBox);
                });
            }
        }

        document.getElementById('search-box').addEventListener('input', (event) => {
            const query = event.target.value;
            if (query.length > 2) { // بدء البحث بعد إدخال 3 أحرف
                searchMovies(query);
            } else {
                updateMovieList([]); // مسح النتائج إذا كان النص قصيرًا جدًا
            }
        });

        // تحميل الأفلام عند تحميل الصفحة
        window.onload = loadAllMovies;
    </script>
</body>
</html>