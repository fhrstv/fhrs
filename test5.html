<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Movie Details</title>
    <style>
 body {
        font-family: 'Arial', sans-serif;
    background-color: #141414;
    color: #fff;
    margin: 0;
    padding: 0;
    line-height: 1.6;
    overflow-x: hidden;
      touch-action: manipulation; /* يمنع التكبير التلقائي عند النقر المتعدد */
}



.movie-details {
    display: flex;
    flex-direction: column;
    align-items: center;
    color: #ffffff;
    font-size: 20px;
    margin-bottom: 10px;
    text-align: center;
    font-weight: bold;
    direction: rtl;
}

.movie-details img {
    width: 300px;
    height: auto;
    border-radius: 5px;
}

.movie-details h1 {
    margin: 0;
    color: red;
}

.movie-details p {
    margin: 10px 0;
}

.movie-details p span {
    color: #000; /* تعيين اللون الأسود للـ <span> */
}



header {
    text-align: center; /* توسيط النص */
    font-size: 3em; /* حجم الخط الكبير */
    color: red; /* اللون الأحمر للنص */
    margin: 20px 0; /* إضافة هامش أعلى وأسفل */
    text-shadow: 3px 3px 5px rgba(0, 0, 0, 0.5); /* إضافة ظل للنص */
    cursor: pointer; /* تغيير شكل المؤشر عند التمرير فوق النص */
}


a {
    text-decoration: none;
    color: #ffffff;
    display: block;
    padding: 20px;
    border-radius: 10px;
    background-color: red;
    transition: transform 0.3s, box-shadow 0.3s;
    font-size: 25px;
    text-align: center;
    margin: 20px auto;
    width: 60%;
    max-width: 600px;
    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
    perspective: 1000px; /* إضافة منظور لتحقيق التأثير ثلاثي الأبعاد */
}

/* تأثير ثلاثي الأبعاد عند تمرير الفأرة */
a:hover {
    transform: scale(1.05) translateZ(15px); /* تكبير المربع وتحريكه في المحور Z */
    background-color: darkred; /* تغيير اللون عند التمرير فوق العنصر */
    box-shadow: 0 6px 12px rgba(0, 0, 0, 0.4); /* زيادة الظل عند التمرير فوق العنصر */
}

h2, h3, a {
    color: #000;
}

h4 {
    font-size: 40px;
    margin: 0;
}

.movie-details strong {
    color: #000; /* تعيين اللون الأسود */
}

.movie-details span {
    color: #000; /* تعيين اللون الأسود */
}




img {
    max-width: 300px;
    height: auto;
    margin: 20px auto;
    display: block;
    border: 5px solid; /* عرض الإطار */
    border-image: linear-gradient(45deg, #000000, #ff0000, #250f0f) 1;
}
/* CSS لتصميم العناصر بحيث تكون أصغر مع الحفاظ على التناسب */
.movie-embed-container, .trailer-container {
    position: relative;
    width: 80%; /* تحديد العرض كنسبة مئوية من العرض الكامل للعنصر الأم */
    max-width: 800px; /* تحديد أقصى عرض للحاوية */
    height: -500px; /* بداية الارتفاع بـ 0 */
    padding-top: 35%; /* نسبة العرض إلى الارتفاع (9:16) لتصغير الحجم */
    margin: auto; /* توسيط العنصر */
    border: 5px solid; /* عرض الإطار */
    border-image: linear-gradient(45deg, #FF5733, #33FF57, #3357FF); /* خليط الألوان */
    border-image-slice: 1; /* تطبيق خليط الألوان على الإطار */
    overflow: hidden; /* إخفاء أي جزء من الفيديو يتجاوز الحاوية */
}

.movie-embed-container iframe, .trailer-container iframe {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    border: none; /* إزالة الحدود حول الفيديو */
}






    </style>
</head>
<b href="/">
    <header>فهرس</header>
</b>
<body>
    
    <div class="movie-details" id="movie-details">
        <img src="" alt="Movie Poster">
        <h1>Movie Title</h1>
        <p><strong>تاريخ الاصدار : </strong> <span id="release-date">N/A</span></p>
        <p><strong>القصة : </strong> <span id="overview">No overview available.</span></p>
        <p><strong>النوع : </strong> <span id="genre">N/A</span></p>
        <p><strong>التقييم : </strong> <span id="rating">N/A</span></p>
        <h2>التريلر</h2>
        <div class="trailer-container" id="trailer-container"></div>
        <h2>مشاهدة الفيلم</h2>
        <div class="movie-embed-container" id="movie-embed-container"></div>
        <a href="../../Movies">رجوع</a>
    </div>
</header>
    

    <script>
        const apiKey = 'cf64a661774f647b7513facb9f1e55e5';

async function fetchMovieDetails(tmdbId) {
  const url = `https://api.themoviedb.org/3/movie/${tmdbId}?api_key=${apiKey}&language=ar`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error('فشل في جلب تفاصيل الفيلم.');
    }
    const data = await response.json();
    return data;
  } catch (error) {
    console.error('خطأ في جلب تفاصيل الفيلم:', error);
    return null;
  }
}

async function fetchMovieVideos(tmdbId) {
  const url = `https://api.themoviedb.org/3/movie/${tmdbId}/videos?api_key=${apiKey}&language=en`;

  try {
    const response = await fetch(url);
    if (!response.ok) {
      throw new Error('فشل في جلب فيديوهات الفيلم.');
    }
    const data = await response.json();
    return data.results;
  } catch (error) {
    console.error('خطأ في جلب فيديوهات الفيلم:', error);
    return [];
  }
}

function getQueryParameter(name) {
  const urlParams = new URLSearchParams(window.location.search);
  return urlParams.get(name);
}

async function checkIframeMessage() {
  const iframe = document.getElementById('movie-embed-container').querySelector('iframe');
  iframe.onload = function() {
    const iframeContent = iframe.contentDocument || iframe.contentWindow.document;
    const messageElement = iframeContent.querySelector('h4');
    if (messageElement && messageElement.textContent === 'This media is unavailable at the moment.') {
      // Redirect to a custom error page or previous page
      window.location.href = '/error-page.html'; // or '/previous-page.html'
    }
  };
}

async function displayMovieDetails() {
  const tmdbId = getQueryParameter('tmdb_id');

  if (!tmdbId) {
    document.getElementById('movie-details').innerHTML = '<p>لم يتم توفير معرّف الفيلم.</p>';
    return;
  }

  const movieData = await fetchMovieDetails(tmdbId);
  const movieVideos = await fetchMovieVideos(tmdbId);

  if (movieData) {
    document.querySelector('h1').textContent = movieData.title || 'لا يوجد عنوان';
    document.querySelector('img').src = movieData.poster_path ? `https://image.tmdb.org/t/p/w500/${movieData.poster_path}` : '';
    document.getElementById('release-date').textContent = movieData.release_date || 'غير متوفر';
    document.getElementById('overview').textContent = movieData.overview || 'لا يوجد ملخص متاح.';

    // Display genre
    const genres = movieData.genres.map(genre => genre.name).join(', ');
    document.getElementById('genre').textContent = genres || 'غير متوفر';

    // Display rating (formatted to 1 decimal place)
    const rating = movieData.vote_average ? movieData.vote_average.toFixed(1) : 'غير متوفر';
    document.getElementById('rating').textContent = `${rating} / 10`;

    // Embed movie from Vidsrc
    document.getElementById('movie-embed-container').innerHTML = `
      <iframe src="https://vidsrc.xyz/embed/movie?tmdb=${tmdbId}" allowfullscreen></iframe>
    `;

    // Check the iframe message
    checkIframeMessage();

    // Find and display the first trailer
    const trailer = movieVideos.find(video => video.type === 'Trailer' && video.site === 'YouTube');
    if (trailer) {
      document.getElementById('trailer-container').innerHTML = `
        <iframe src="https://www.youtube.com/embed/${trailer.key}" allowfullscreen></iframe>
      `;
    } else {
      document.getElementById('trailer-container').innerHTML = '<p>لا يوجد تريلر متاح.</p>';
    }
  } else {
    document.getElementById('movie-details').innerHTML = '<p>فشل في تحميل تفاصيل الفيلم.</p>';
  }
}

window.onload = displayMovieDetails;

    </script>

</body>
</html>