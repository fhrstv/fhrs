<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <title>Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ù…Ø³Ù„Ø³Ù„ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© (TMDB)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Tesseract.js Ù…Ù† CDN (OCR ÙÙŠ Ø§Ù„Ù…ØªØµÙØ­) -->
  <script src="https://unpkg.com/tesseract.js@v6.0.0/dist/tesseract.min.js"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: #0b1020;
      color: #f5f5f5;
      margin: 0;
      padding: 1.5rem;
      display: flex;
      justify-content: center;
    }
    .container {
      max-width: 800px;
      width: 100%;
      background: #12172a;
      border-radius: 16px;
      padding: 1.5rem;
      box-shadow: 0 12px 30px rgba(0,0,0,0.5);
    }
    h1 {
      font-size: 1.4rem;
      margin-top: 0;
      text-align: center;
    }
    .upload-box {
      border: 2px dashed #2d3b70;
      border-radius: 12px;
      padding: 1rem;
      text-align: center;
      margin-bottom: 1rem;
      background: #171c33;
    }
    input[type="file"] {
      margin-top: 0.5rem;
    }
    #preview {
      max-width: 100%;
      max-height: 260px;
      margin-top: 0.75rem;
      border-radius: 12px;
      display: none;
    }
    button {
      margin-top: 1rem;
      padding: 0.6rem 1.2rem;
      border-radius: 999px;
      border: none;
      cursor: pointer;
      font-size: 0.95rem;
      font-weight: 600;
      background: linear-gradient(135deg,#3b82f6,#a855f7);
      color: white;
    }
    button:disabled {
      opacity: 0.5;
      cursor: default;
    }
    .status {
      margin-top: 0.75rem;
      font-size: 0.9rem;
      color: #e5e7eb;
      min-height: 1.2rem;
    }
    .small-label {
      font-size: 0.8rem;
      opacity: 0.8;
      margin-top: 0.5rem;
    }
    #ocrText {
      width: 100%;
      min-height: 60px;
      margin-top: 0.5rem;
      border-radius: 8px;
      border: 1px solid #374151;
      background: #0f172a;
      color: #e5e7eb;
      padding: 0.5rem;
      font-size: 0.85rem;
      resize: vertical;
      box-sizing: border-box;
    }
    .results {
      margin-top: 1rem;
    }
    .result-item {
      border-radius: 12px;
      background: #0e1425;
      padding: 0.75rem;
      display: flex;
      gap: 0.75rem;
      margin-bottom: 0.6rem;
      align-items: flex-start;
    }
    .result-item img {
      width: 70px;
      border-radius: 8px;
      object-fit: cover;
      background: #020617;
      flex-shrink: 0;
    }
    .result-details h3 {
      margin: 0 0 0.25rem 0;
      font-size: 0.95rem;
    }
    .result-details p {
      margin: 0;
      font-size: 0.8rem;
      color: #9ca3af;
    }
    a {
      color: #60a5fa;
      text-decoration: none;
      font-size: 0.8rem;
    }
    a:hover {
      text-decoration: underline;
    }
    .note {
      font-size: 0.8rem;
      color: #9ca3af;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>
<div class="container">
  <h1>ğŸ” Ø§Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© (TMDB)</h1>

  <div class="upload-box">
    <div>Ø§Ø®ØªØ± Ø¨ÙˆØ³ØªØ± Ø£Ùˆ Ù„Ù‚Ø·Ø© ÙÙŠÙ‡Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„</div>
    <input id="imageInput" type="file" accept="image/*" />
    <img id="preview" alt="Preview" />
    <div class="note">
      Ø§Ù„Ø£ÙØ¶Ù„ ØªÙƒÙˆÙ† Ø§Ù„ØµÙˆØ±Ø© ÙˆØ§Ø¶Ø­Ø© ÙˆÙÙŠÙ‡Ø§ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…Ù„ Ø¨Ø§Ù„Ø¥Ù†Ø¬Ù„ÙŠØ²ÙŠ Ø£Ùˆ Ø¨Ø­Ø±ÙˆÙ ÙˆØ§Ø¶Ø­Ø©.
    </div>
  </div>

  <div class="small-label">Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© (ØªÙ‚Ø¯Ø± ØªØ¹Ø¯Ù„Ù‡ Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø­Ø«):</div>
  <textarea id="ocrText" placeholder="Ø±Ø§Ø­ ÙŠØ¸Ù‡Ø± Ù‡Ù†Ø§ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„ ØªÙ‚Ø±ÙŠØ¨Ø§Ù‹ Ø¨Ø¹Ø¯ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„ØµÙˆØ±Ø©..."></textarea>

  <button id="analyzeBtn">1ï¸âƒ£ Ø§Ù‚Ø±Ø£ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©</button>
  <button id="searchBtn">2ï¸âƒ£ Ø§Ø¨Ø­Ø« ÙÙŠ TMDB Ø¹Ù† Ø§Ù„Ù…Ø³Ù„Ø³Ù„</button>

  <div class="status" id="status"></div>

  <div class="results" id="results"></div>

  <div class="note">
    Ù…Ù„Ø§Ø­Ø¸Ø©: Ù‡Ø°Ø§ Ø§Ù„Ù…ÙˆÙ‚Ø¹ ØªØ¬Ø±ÙŠØ¨ÙŠ ÙˆÙŠØ³ØªØ®Ø¯Ù… TMDB API + Tesseract.js ÙÙ‚Ø· Ù…Ù† Ø§Ù„Ù…ØªØµÙØ­.
  </div>
</div>

<script>
  // âš ï¸ Ø¶Ø¹ Ù‡Ù†Ø§ TMDB API Key Ø­Ù‚Ùƒ
  const TMDB_API_KEY = "cf64a661774f647b7513facb9f1e55e5";

  const imageInput = document.getElementById("imageInput");
  const preview = document.getElementById("preview");
  const statusEl = document.getElementById("status");
  const ocrTextArea = document.getElementById("ocrText");
  const analyzeBtn = document.getElementById("analyzeBtn");
  const searchBtn = document.getElementById("searchBtn");
  const resultsEl = document.getElementById("results");

  let selectedFile = null;

  imageInput.addEventListener("change", (e) => {
    const file = e.target.files[0];
    selectedFile = file || null;
    resultsEl.innerHTML = "";
    if (!file) {
      preview.style.display = "none";
      statusEl.textContent = "";
      return;
    }
    const reader = new FileReader();
    reader.onload = (ev) => {
      preview.src = ev.target.result;
      preview.style.display = "block";
    };
    reader.readAsDataURL(file);
    statusEl.textContent = "Ø§Ù„ØµÙˆØ±Ø© Ø¬Ø§Ù‡Ø²Ø©ØŒ Ø§Ø¶ØºØ· Ø¹Ù„Ù‰ (1ï¸âƒ£ Ø§Ù‚Ø±Ø£ Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©)";
  });

  async function runOCR() {
    if (!selectedFile) {
      statusEl.textContent = "Ø­Ù…Ù‘Ù„ ØµÙˆØ±Ø© Ø£ÙˆÙ„Ø§Ù‹.";
      return;
    }
    analyzeBtn.disabled = true;
    searchBtn.disabled = true;
    statusEl.textContent = "Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø© (OCR)... Ù‡Ø°Ø§ Ù‚Ø¯ ÙŠØ£Ø®Ø° Ø¹Ø¯Ø© Ø«ÙˆØ§Ù†ÙŠ.";

    try {
      const worker = await Tesseract.createWorker({
        logger: (m) => {
          // ØªÙ‚Ø¯Ø± ØªØ´ÙˆÙ Ø§Ù„ØªÙ‚Ø¯Ù… ÙÙŠ Ø§Ù„Ù€ console Ù„Ùˆ Ø­Ø§Ø¨
          // console.log(m);
        }
      });
      await worker.load();
      await worker.loadLanguage("eng"); // Ù„Ùˆ Ø­Ø§Ø¨ ØªØ¶ÙŠÙ Ù„ØºØ§Øª Ø«Ø§Ù†ÙŠØ© Ù…Ù…ÙƒÙ† Ù„Ø§Ø­Ù‚Ø§Ù‹
      await worker.initialize("eng");

      const { data: { text } } = await worker.recognize(selectedFile);
      await worker.terminate();

      const cleaned = text
        .split("\n")
        .map(t => t.trim())
        .filter(Boolean)
        .join(" ");

      ocrTextArea.value = cleaned || text || "";
      if (ocrTextArea.value.trim()) {
        statusEl.textContent = "ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ù†ØµØŒ ØªÙ‚Ø¯Ø± ØªØ¹Ø¯Ù„Ù‡ ÙˆØ§Ø¶ØºØ· (2ï¸âƒ£ Ø§Ø¨Ø­Ø« ÙÙŠ TMDB).";
      } else {
        statusEl.textContent = "Ù…Ø§ Ù‚Ø¯Ø± ÙŠÙ‚Ø±Ø£ Ù†Øµ ÙˆØ§Ø¶Ø­ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø¬Ø±Ù‘Ø¨ ØµÙˆØ±Ø© Ø£Ù†Ø¸Ù Ø£Ùˆ Ø¨ÙˆØ³ØªØ± Ø«Ø§Ù†ÙŠ.";
      }
    } catch (err) {
      console.error(err);
      statusEl.textContent = "ØµØ§Ø± Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù†Øµ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©.";
    } finally {
      analyzeBtn.disabled = false;
      searchBtn.disabled = false;
    }
  }

  async function searchTMDB() {
    const query = ocrTextArea.value.trim();
    resultsEl.innerHTML = "";
    if (!query) {
      statusEl.textContent = "Ø§ÙƒØªØ¨ Ø§Ø³Ù… Ø§Ù„Ù…Ø³Ù„Ø³Ù„ (Ø£Ùˆ Ø§Ø³ØªØ®Ø±Ø¬Ù‡ Ù…Ù† Ø§Ù„ØµÙˆØ±Ø©) Ù‚Ø¨Ù„ Ø§Ù„Ø¨Ø­Ø«.";
      return;
    }
    if (!TMDB_API_KEY || TMDB_API_KEY === "YOUR_TMDB_API_KEY_HERE") {
      statusEl.textContent = "âš ï¸ Ù„Ø§Ø²Ù… ØªØ­Ø· TMDB API Key ÙÙŠ Ø§Ù„ÙƒÙˆØ¯ Ù‚Ø¨Ù„ Ù…Ø§ ÙŠØ´ØªØºÙ„ Ø§Ù„Ø¨Ø­Ø«.";
      return;
    }

    searchBtn.disabled = true;
    analyzeBtn.disabled = true;
    statusEl.textContent = `Ø¬Ø§Ø±ÙŠ Ø§Ù„Ø¨Ø­Ø« ÙÙŠ TMDB Ø¹Ù†: "${query}" ...`;

    try {
      const url = new URL("https://api.themoviedb.org/3/search/tv");
      url.searchParams.set("api_key", TMDB_API_KEY);
      url.searchParams.set("query", query);
      url.searchParams.set("language", "en-US");

      const res = await fetch(url.toString());
      if (!res.ok) throw new Error("TMDB request failed");
      const data = await res.json();

      if (!data.results || data.results.length === 0) {
        statusEl.textContent = "Ù…Ø§ Ù„Ù‚ÙŠØª Ù…Ø³Ù„Ø³Ù„Ø§Øª ØªØ·Ø§Ø¨Ù‚ Ø§Ù„Ù†Øµ Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬. Ø¹Ø¯Ù‘Ù„ Ø§Ù„Ø§Ø³Ù… ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø«Ø§Ù†ÙŠØ©.";
        return;
      }

      statusEl.textContent = `ØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ ${data.results.length} Ù†ØªÙŠØ¬Ø© (Ø£ÙˆÙ„ 5 ØªØ¸Ù‡Ø± ØªØ­Øª).`;
      const top = data.results.slice(0, 5);
      for (const tv of top) {
        const item = document.createElement("div");
        item.className = "result-item";

        const img = document.createElement("img");
        if (tv.poster_path) {
          img.src = "https://image.tmdb.org/t/p/w200" + tv.poster_path;
          img.alt = tv.name;
        } else {
          img.style.display = "none";
        }

        const details = document.createElement("div");
        details.className = "result-details";

        const title = document.createElement("h3");
        title.textContent = tv.name + (tv.first_air_date ? ` (${tv.first_air_date.slice(0,4)})` : "");

        const overview = document.createElement("p");
        overview.textContent = tv.overview || "Ù„Ø§ ÙŠÙˆØ¬Ø¯ ÙˆØµÙ Ù…ØªÙˆÙØ±.";

        const link = document.createElement("a");
        link.href = `https://www.themoviedb.org/tv/${tv.id}`;
        link.target = "_blank";
        link.rel = "noopener noreferrer";
        link.textContent = "Ø¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù…Ø³Ù„Ø³Ù„ ÙÙŠ TMDB";

        details.appendChild(title);
        details.appendChild(overview);
        details.appendChild(link);

        item.appendChild(img);
        item.appendChild(details);

        resultsEl.appendChild(item);
      }
    } catch (err) {
      console.error(err);
      statusEl.textContent = "ØµØ§Ø± Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ø§Ù„Ø§ØªØµØ§Ù„ Ø¨Ù€ TMDB. ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„Ù€ API Key ÙˆØ§Ù„Ø¥Ù†ØªØ±Ù†Øª.";
    } finally {
      searchBtn.disabled = false;
      analyzeBtn.disabled = false;
    }
  }

  analyzeBtn.addEventListener("click", runOCR);
  searchBtn.addEventListener("click", searchTMDB);
</script>
</body>
</html>